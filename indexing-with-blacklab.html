<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2017-06-12 
 | Rendered using Apache Maven Fluido Skin 1.4
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170612" />
    <meta http-equiv="Content-Language" content="en" />
    <title>BlackLab &#x2013; Indexing with BlackLab</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.4.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.4.min.js"></script>

                          
        
<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Nunito:300"/>
          
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                                                                                                <img src="images/logo-blacklab.png"  alt="BlackLab"/>
                </div>
                      </div>
        <div class="pull-right">                  <a href="http://www.inl.nl/" id="bannerRight">
                                                                                                <img src="images/logo-inl.png"  alt="INL"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                              <li class="">
                    <a href="http://www.inl.nl/" class="externalLink" title="INL">
        INL</a>
                    <span class="divider">/</span>
      </li>
            <li class="">
                    <a href="index.html" title="BlackLab">
        BlackLab</a>
                    <span class="divider">/</span>
      </li>
        <li class="active ">Indexing with BlackLab</li>
        
                
                    
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2017-06-12</li>
              <li id="projectVersion" class="pull-right">
                    Version: 1.6.0
        </li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">BlackLab</li>
                              
      <li>
  
                          <a href="index.html" title="Introduction">
          <span class="none"></span>
        Introduction</a>
            </li>
                                                                                                                                                                                                                      
      <li>
  
                          <a href="learn.html" title="Learn">
          <span class="icon-chevron-down"></span>
        Learn</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="getting-started.html" title="Getting Started">
          <span class="none"></span>
        Getting Started</a>
            </li>
                    
      <li>
  
                          <a href="corpus-query-language.html" title="Corpus Query Language">
          <span class="none"></span>
        Corpus Query Language</a>
            </li>
                    
      <li>
  
                          <a href="blacklab-server-overview.html" title="BlackLab Server overview">
          <span class="none"></span>
        BlackLab Server overview</a>
            </li>
                    
      <li>
  
                          <a href="blacklab-server-different-languages.html" title="Using BlackLab Server from different languages">
          <span class="none"></span>
        Using BlackLab Server from different languages</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>Indexing with BlackLab</a>
          </li>
                    
      <li>
  
                          <a href="add-input-format.html" title="Add An Input Format">
          <span class="none"></span>
        Add An Input Format</a>
            </li>
                    
      <li>
  
                          <a href="improve-search-speed.html" title="Improve Search Speed">
          <span class="none"></span>
        Improve Search Speed</a>
            </li>
                    
      <li>
  
                          <a href="apidocs/index.html" title="API reference">
          <span class="none"></span>
        API reference</a>
            </li>
                    
      <li>
  
                          <a href="file-formats.html" title="File formats">
          <span class="none"></span>
        File formats</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="downloads.html" title="Downloads">
          <span class="none"></span>
        Downloads</a>
            </li>
                
      <li>
  
                          <a href="faq.html" title="FAQ">
          <span class="none"></span>
        FAQ</a>
            </li>
                
      <li>
  
                          <a href="changelog.html" title="Change Log">
          <span class="none"></span>
        Change Log</a>
            </li>
                
      <li>
  
                          <a href="roadmap.html" title="Road Map">
          <span class="none"></span>
        Road Map</a>
            </li>
                
      <li>
  
                          <a href="newsletter.html" title="Newsletter">
          <span class="none"></span>
        Newsletter</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                
      <li>
  
                          <a href="project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                                      
      <li>
  
                          <a href="project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1>Indexing with BlackLab</h1>

<ul>
  
<li><a href="#index-supported-format">Indexing documents in a supported format</a></li>
  
<li><a href="#supported-formats">Supported formats</a></li>
  
<li><a href="#passing-indexing-parameters">Passing indexing parameters</a></li>
  
<li><a href="#sensitivity">Configuring case- and diacritics sensitivity per property</a></li>
  
<li><a href="#index-struct">Configuring the index structure</a>
  
<ul>
    
<li><a href="#disable-fi">When and how to disable the forward index for a property</a></li>
  </ul></li>
  
<li><a href="#index-custom-format">Indexing documents in a custom format</a>
  
<ul>
    
<li><a href="#word-annotated">Indexing word-annotated XML</a></li>
    
<li><a href="#multiple-values">Multiple values at one position, position gaps and adding property values at an earlier position</a></li>
    
<li><a href="#subproperties">Subproperties, for e.g. making part of speech features separately searchable</a> (EXPERIMENTAL)</li>
    
<li><a href="#payloads">Storing extra information with property values, using payloads</a></li>
    
<li><a href="#nonxml">Indexing non-XML file types</a></li>
  </ul></li>
  
<li><a href="#metadata">Metadata</a>
  
<ul>
    
<li><a href="#metadata-in-document">In-document metadata</a></li>
    
<li><a href="#metadata-external">Metadata from an external source</a></li>
  </ul></li>
</ul>
<p><a name="index-supported-format" id="index-supported-format"></a></p>
<div class="section">
<h2><a name="Indexing_documents_in_a_supported_format"></a>Indexing documents in a supported format</h2>
<p>Start the IndexTool without parameters for help information:</p>

<div class="source">
<div class="source"><pre class="prettyprint">java -cp BLACKLAB_JAR nl.inl.blacklab.tools.IndexTool
</pre></div></div>
<p>To create a new index:</p>

<div class="source">
<div class="source"><pre class="prettyprint">java -cp BLACKLAB_JAR nl.inl.blacklab.tools.IndexTool create INDEX_DIR INPUT_FILES FORMAT
</pre></div></div>
<p>To add documents to an existing index:</p>

<div class="source">
<div class="source"><pre class="prettyprint">java -cp BLACKLAB_JAR nl.inl.blacklab.tools.IndexTool add INDEX_DIR INPUT_FILES FORMAT
</pre></div></div>
<p>If you specify a directory as the INPUT_FILES, it will be scanned recursively. You can also specify a file glob (such as *.xml; single-quote it if you&#x2019;re on Linux so it doesn&#x2019;t get expanded by the shell) or a single file. If you specify a .zip or .tar.gz file, BlackLab will automatically index the contents.</p>
<p>For example, if you have TEI data in /tmp/my-tei/ and want to create an index as a subdirectory of the current directory called &#x201c;test-index&#x201d;, run the following command:</p>

<div class="source">
<div class="source"><pre class="prettyprint">java -cp BLACKLAB_JAR nl.inl.blacklab.tools.IndexTool create test-index /tmp/my-tei/ tei
</pre></div></div>
<p>Your data is indexed and placed in a new BlackLab index in the &#x201c;test-index&#x201d; directory.</p>
<p>NOTE: if you don&#x2019;t specify a glob, IndexTool will index *.xml by default. You can specify a glob (like &#x201c;*.txt&#x201d; or &#x201c;*&#x201d; for all files) to change this.</p>
<p>To delete documents from an index:</p>

<div class="source">
<div class="source"><pre class="prettyprint">java -cp BLACKLAB_JAR nl.inl.blacklab.tools.IndexTool delete INDEX_DIR FILTER_QUERY
</pre></div></div>
<p>Here, FILTER_QUERY is a metadata filter query in Lucene query language that matches the documents to delete. Deleting documents and re-adding them can be used to update documents.</p>
<p><a name="supported-formats" id="supported-formats"></a></p></div>
<div class="section">
<h2><a name="Supported_formats"></a>Supported formats</h2>
<p>Here&#x2019;s a list of supported input formats:</p>

<ul>
  
<li>folia (a corpus XML format popular in the Netherlands; see <a class="externalLink" href="https://proycon.github.io/folia/">https://proycon.github.io/folia/</a>)</li>
  
<li>tei (a popular XML format for linguistic resources, including corpora. indexes content inside the &#x2018;body&#x2019; element; assumes part of speech is found in an attribute called &#x2018;type&#x2019;; see <a class="externalLink" href="http://www.tei-c.org/">http://www.tei-c.org/</a>)</li>
  
<li>tei-element-text (a variant of TEI where content inside the &#x2018;text&#x2019; element is indexed)</li>
  
<li>tei-pos-function (a variant of TEI where part of speech is in an attribute called &#x2018;function&#x2019;)</li>
  
<li>sketchxml (a simple XML format based on the word-per-line files that the Sketch Engine and CWB use)</li>
  
<li>pagexml (OCR XML format)</li>
  
<li>alto (OCR XML format; see <a class="externalLink" href="http://www.loc.gov/standards/alto/">http://www.loc.gov/standards/alto/</a>)</li>
</ul>
<p>Adding support for your own format is not hard. See below, or have a look at <a href="add-input-format.html">Adding an input format</a>. To use your own DocIndexer class with IndexTool, specify the fully-qualified class name as the FORMAT parameters.</p>
<p><a name="passing-indexing-parameters" id="passing-indexing-parameters"></a></p></div>
<div class="section">
<h2><a name="Passing_indexing_parameters"></a>Passing indexing parameters</h2>
<p>You can pass parameters to the DocIndexer class to customize its indexing process. This can be done in two ways: as options on the IndexTool command line, or via a properties file.</p>
<p>To pass a parameter as an option on the command line, use three dashes, like this:</p>

<div class="source">
<div class="source"><pre class="prettyprint">java -cp BLACKLAB_JAR nl.inl.blacklab.tools.IndexTool create ---PARAMNAME PARAMVALUE ...
</pre></div></div>
<p>To pass parameters via a property file, use the &#x2013;indexparam option:</p>

<div class="source">
<div class="source"><pre class="prettyprint">java -cp BLACKLAB_JAR nl.inl.blacklab.tools.IndexTool create --indexparam PROPERTYFILE ...
</pre></div></div>
<p>NOTE: in addition to the &#x2013;indexparam parameter, IndexTool will always look for a file named indexer.properties in the current directory, the input directory, the parent of the input directory, or the index directory. If the file is found in any of these locations, it is read and the values are used as indexing parameters. </p>
<p>Use the DocIndexer.getParameter(name[, defaultValue]) method to retrieve parameters inside your DocIndexer. For an example of using DocIndexer parameters, see the DocIndexerTeiBase and MetadataFetcherSonarCmdi in the nl.inl.blacklab.indexers package. They use parameters to configure property names and where to fetch metadata from, respectively.</p>
<p>Configuring an external metadata fetcher (see &#x201c;Metadata from an external source&#x201d; below) and case- and diacritics sensitivity (see next section) is also done using a indexing parameter for now. Note that this parameter passing mechanism predates the index structure file (see &#x201c;Configuring the index structure&#x201d; below) and is likely to be deprecated in favour of that in future versions.</p>
<p><a name="sensitivity" id="sensitivity"></a></p></div>
<div class="section">
<h2><a name="Configuring_case-_and_diacritics_sensitivity_per_property"></a>Configuring case- and diacritics sensitivity per property</h2>
<p>You can also configure what &#x201c;sensitivity alternatives&#x201d; (case/diacritics sensitivity) to index for each property, using the &#x201c;PROPNAME_sensitivity&#x201d; parameter. Accepted values are &#x201c;i&#x201d; (both only insensitive), &#x201c;s&#x201d; (both only sensitive), &#x201c;si&#x201d; (sensitive and insensitive) and &#x201c;all&#x201d; (case/diacritics sensitive and insensitive, so 4 alternatives). What alternatives are indexed determines how specifically you can specify the desired sensitivity when searching.</p>
<p>If you don&#x2019;t configure these, BlackLab will pick (hopefully) sane defaults (i.e. word/lemma get &#x201c;si&#x201d;, punct gets &#x201c;i&#x201d;, starttag gets &#x201c;s&#x201d;, others get &#x201c;i&#x201d;).</p>
<p><a name="index-struct" id="index-struct"></a></p></div>
<div class="section">
<h2><a name="Configuring_the_index_structure"></a>Configuring the index structure</h2>
<p>What we call the &#x201c;index structure&#x201d; consists of some top-level index information (name, description, etc.), what word-level annotations (&#x201c;properties&#x201d;) you want to index, what metadata fields there are and how they should be indexed, and more.</p>
<p>By default, a default index structure is determined by BlackLab and the DocIndexer you&#x2019;re using. However, you can influence exactly how your index is created using a customized index structure file. If you specify such an index structure file when creating the index, it will be used as a template for the index metadata file, and so you won&#x2019;t have to specify the index structure file again when updating your index later; all the information is now in the index metadata file. It is possible to edit the index metadata file manually as well, but use caution, because it might break something.</p>
<p>To use a custom indextemplate.json when creating an index, make sure the file is present either in the input directory, or in the parent directory of the input directory. IndexTool will automatically detect and use it. The resulting indexstructure.json will be saved in the index directory. </p>
<p>Here&#x2019;s a commented example of indextemplate.json (double-slash comments in JSON files are allowed by BlackLab):</p>

<div class="source">
<div class="source"><pre class="prettyprint">// indextemplate.json - indexer options (template for the index's indexmetadata.json)
{
  // Display name for the index and short description
  // (not used by BlackLab. None of the display name or description values
  //  are used by BlackLab directly, but applications can retrieve them if they want)
  &quot;displayName&quot;: &quot;OpenSonar&quot;,
  &quot;description&quot;: &quot;The OpenSonar corpus.&quot;,

  // About the fields in this index
  // (defaults are set by indexer if not specified)
  &quot;fieldInfo&quot;: {
    &quot;namingScheme&quot;: &quot;DEFAULT&quot;,   // ..or &quot;NO_SPECIAL_CHARS&quot; (the alternate naming scheme,
                                 //  which can be used to avoid problems with e.g. Solr)
                                 // (if omitted, DEFAULT is used)
    &quot;titleField&quot;:  &quot;title&quot;,  // ((optional, detected if omitted); field in the index containing
                             //  document title; may be used by applications)
    &quot;authorField&quot;: &quot;author&quot;, // ((optional) field in the index containing author information;
                             //  may be used by applications)
    &quot;dateField&quot;:   &quot;date&quot;,   // ((optional) field in the index containing document date 
                             // information; may be used by applications)
    &quot;pidField&quot;:    &quot;id&quot;,     // ((optional, recommended) field in the index containing unique 
                             //  document id; may be used by applications to refer to documents;
                             //  may be used by BlackLab to directly update documents without 
                             //  the client having to manually delete the previous version)
    &quot;defaultAnalyzerName&quot;: &quot;DEFAULT&quot;,   // The type of analyzer to use for metadata fields
                                        // by default (DEFAULT|whitespace|standard|nontokenizing)
    &quot;contentViewable&quot;: false, // is the user allowed to retrieve whole documents? 
    &quot;documentFormat&quot;: &quot;&quot;,     // (not used by BlackLab. may be used by application to 
                              //  e.g. select which XSLT to use)

    &quot;unknownValue&quot;: &quot;unknown&quot;,   // what value to index if field value is unknown [unknown]
    &quot;unknownCondition&quot;: &quot;NEVER&quot;, // When is a field value considered unknown?
                                 // (other options: MISSING, EMPTY, MISSING_OR_EMPTY) [NEVER]

    &quot;metadataFields&quot;: {

      &quot;author&quot;: {
        &quot;displayName&quot;: &quot;author&quot;,
        &quot;description&quot;: &quot;The author of the document.&quot;,
        &quot;group&quot;: &quot;authorRelated&quot;,     // can be used to group fields in interface
        &quot;type&quot;: &quot;tokenized&quot;,          // ..or text, numeric, untokenized [tokenized]
        &quot;analyzer&quot;: &quot;default&quot;,        // ..(or whitespace|standard|nontokenizing) [default]
        &quot;unknownValue&quot;: &quot;unknown&quot;,    // overrides default unknownValue for this field
        &quot;unknownCondition&quot;: &quot;MISSING_OR_EMPTY&quot; // overrides default unknownCondition for this field
      }
    },
    &quot;complexFields&quot;: {
      &quot;contents&quot;: {
        &quot;mainProperty&quot;: &quot;word&quot;,     // used for concordances; contains char. offsets
        &quot;displayName&quot;: &quot;contents&quot;,  // may be used by application
        &quot;description&quot;: &quot;The text contents of the document.&quot;,  // may be used by application
        &quot;noForwardIndexProps&quot;: &quot;&quot;   // space-separated list of property names that shouldn't
                                    // get a forward index [&quot;&quot;]
      }
    }
  }
}
</pre></div></div>
<p><a name="disable-fi" id="disable-fi"></a></p>
<p>Please note: the settings pidField, titleField, authorField, dateField refer to the name of the field in the Lucene index, not an XML element name.</p>
<div class="section">
<h3><a name="When_and_how_to_disable_the_forward_index_for_a_property"></a>When and how to disable the forward index for a property</h3>
<p>By default, all properties get a forward index. The forward index is the complement to Lucene&#x2019;s reverse index, and can quickly answer the question &#x201c;what value appears in position X of document Y?&#x201d;. This functionality is used to generate snippets (such as for keyword-in-context (KWIC) views), to sort and group based on context words (such as sorting on the word left of the hit) and will in the future be used to speed up certain query types.</p>
<p>However, forward indices take up a lot of disk space and can take up a lot of memory, and they are not always needed for every property. You should probably have a forward index for at least the word and punct properties, and for any property you&#x2019;d like to sort/group on or that you use heavily in searching, or that you&#x2019;d like to display in KWIC views. But if you add a property that is only used in certain special cases, you can decide to disable the forward index for that property. You can do this by adding the property name to the &#x201c;noForwardIndexProps&#x201d; space-separated list in the indextemplate.json file shown above.</p>
<p>A note about forward indices and indexing multiple values at a single corpus position: as of right now, the forward index will only store the first value indexed at any position. We would like to expand this so that it is possible to quickly retrieve all values indexed at a corpus position, but that is not the case now.</p>
<p>Note that if you want KWICs or snippets that include properties without a forward index (as well the rest of the original XML), you can switch to using the original XML to generate KWICs and snippets, at the cost of speed. To do this, pass usecontent=orig to BlackLab Server, or call Hits.settings().setConcordanceType(ConcordanceType.CONTENT_STORE).</p>
<p><a name="index-custom-format" id="index-custom-format"></a></p></div></div>
<div class="section">
<h2><a name="Indexing_documents_in_a_custom_format"></a>Indexing documents in a custom format</h2>
<p>See also <a href="add-input-format.html">Adding an input format</a>.</p>
<p>If you have text in a format that isn&#x2019;t supported by BlackLab yet, you will have to create a DocIndexer class to support the format. You can use the DocIndexer classes supplied with BlackLab (see the nl.inl.blacklab.indexers package) for reference, but we&#x2019;ll highlight the most important features here.</p>
<p><a name="word-annotated" id="word-annotated"></a></p>
<div class="section">
<h3><a name="Indexing_word-annotated_XML"></a>Indexing word-annotated XML</h3>
<p>If you have an XML format in which each word has its own XML tag, containing any annotations, you should derive your DocIndexer class from DocIndexerXmlHandlers. This class allows you to add &#x2018;hooks&#x2019; for handling different XML elements.</p>
<p>(for a practical example of the following, see <a href="add-input-format.html">Adding an input format</a>)</p>
<p>The constructor of your indexing class should call the superclass constructor, declare any annotations (e.g. lemma, pos) you&#x2019;re going to index and finally add hooks (called handlers) for each XML element you want to do something with.</p>
<p>Declaring annotations (called &#x201c;properties&#x201d; in BlackLab) is done using the DocIndexerXmlHandlers.addProperty(String). Store the result in a final variable so you can access it from your custom handlers. Note that the &#x201c;main property&#x201d; (usually called &#x201c;word&#x201d;) and the &#x201c;punct&#x201d; property (whitespace and punctuation between words) have already been created by DocIndexerXmlHandlers; retrieve them using the getMainProperty() and getPropPunct() methods.</p>
<p>Adding a handler is done using the DocIndexerXmlHandlers.addHandler(String, ElementHandler) method. The first parameter is an xpath-like expression that indicates the element to handle. The expression looks like xpath but is very limited: only element names separated by slashes; it may start with either a single (absolute path) or a double (relative path) slash. DocIndexerXmlHandlers defines several default ElementHandlers: ElementHandler (does nothing but keep track of whether we&#x2019;re inside this element), DocumentElementHandler (creates and adds document to the index), several metadata handlers that deal with different types of metadata elements (assuming the document contains its own metadata - see below for external metadata), InlineTagHandler (adds inline tags from the content to the index, such as &lt;p&gt;, &lt;s&gt; (sentence), &lt;b&gt;), several word handlers (indexes words and whitespace/punctuation between words). You can also easily create or derive your own, usually as an anonymous inner class that overrides the startElement() and endElement() methods.</p>
<p>You need to add a handler for your document element (signifying the start and end of your logical documents; probably just use DocumentElementHandler), your word element (signifying a word to index; probably derive from WordHandlerBase), and any inline tags you wish to index (probably just use InlineTagHandler). Optionally, you may want to add a simple ElementHandler for your &#x201c;body&#x201d; tag, if you wish to restrict what part of the document is actually indexed; in this case, you should expand your word and inline tag handlers to check that you&#x2019;re inside this body element before processing the matched element. </p>
<p>A word handler derived from DefaultWordHandler might retrieve lemma and part of speech from the attributes of the start tag and add them to the properties you declared at the top of your DocIndexer-constructor. You can do this using the ComplexFieldProperty.addValue() method. DefaultWordHandler takes care of adding values to the standard properties word and punct. For this, DefaultWordHandler assumes the word is simply the word element&#x2019;s text content. DefaultWordHandler also stores the character positions before and after the word (which are needed if you want to highlight in the original XML).</p>
<p>An important note about adding values to properties: it is crucial that you call ComplexFieldProperty.addValue() to each property an equal number of times! Each time you call addValue(), you move that property to the next corpus position, but other properties do not automatically move to the next corpus position; it is up to you to make sure all properties stay at the same corpus position. If a property has no value at a certain position, just add an empty string. </p>
<p>You should probably call consumeCharacterContent(), which clears the buffer of captured text content in the document, at the start of a document (or at the start of the body element, if you handle that separately). This prevents the first punct value containing already captured text content you don&#x2019;t want. Similarly, before storing the document, you should add one last punct value (using consumeCharacterContent() to get the value to store), so the last bit of whitespace/punctuation isn&#x2019;t skipped. BlackLab assumes that there&#x2019;s always an extra &#x201c;dummy&#x201d; token containing only the last bit of whitespace/punctuation.</p>
<p>The <a href="add-input-format.html">tutorial</a> develops a simple TEI DocIndexer using the above techniques.</p>
<p><a name="multiple-values" id="multiple-values"></a></p></div>
<div class="section">
<h3><a name="Multiple_values_at_one_position_position_gaps_and_adding_property_values_at_an_earlier_position"></a>Multiple values at one position, position gaps and adding property values at an earlier position</h3>
<p>The ComplexFieldProperty.addValue(String) method adds a value to a property (&#x201c;annotation layer&#x201d;) at the next corpus position. Sometimes you may want to add multiple values at a single corpus position, or you may want to skip a number of corpus positions. This can be done using the ComplexFieldProperty.addValue(String, Integer) method; the second parameter is the increment compared to the previous value. The default value for the increment is 1, meaning each value is indexed at the next corpus position.</p>
<p>To add multiple values to a single corpus position, only use the default increment of 1 for the first value you want to add at this position; for all subsequent values at this position, use an increment of 0. Note: if the value you added first was the empty string, adding the next value with an increment of 0 will overwrite this empty string. This can be convenient if you&#x2019;re not sure whether you want to add any values at a particular location, but you want to make sure the property stays at the correct corpus position regardless.</p>
<p>To skip a number of corpus positions when adding a value, use an increment that is higher than 1. So to skip one position (and therefore leave a &#x201c;gap&#x201d; one wide), use an increment of 2.</p>
<p>Finally, you may sometimes wish to add values to an earlier corpus position. Say you&#x2019;re at position 100, and you want to add a value to position 50. You can do so using the ComplexFieldProperty.addValueAtPosition(String, Integer) method. The first token has position 0.</p>
<p><a name="subproperties" id="subproperties"></a></p></div>
<div class="section">
<h3><a name="Subproperties_for_e.g._making_part_of_speech_features_separately_searchable_EXPERIMENTAL"></a>Subproperties, for e.g. making part of speech features separately searchable (EXPERIMENTAL)</h3>
<p>Note that this feature is experimental and details may change in future versions.</p>
<p>Part of speech sometimes consists of several features in addition to the main PoS, e.g. &#x201c;NOU-C(gender=n,number=sg)&#x201d;. It would be nice to be able to search each of these features separately without resorting to complex regular expressions. You can use the feature described above (multiple values at one position) to achieve this. We call this approach &#x201c;subproperties&#x201d;, because you index the values of several &#x201c;subproperties&#x201d; in a single Lucene field.</p>
<p>To add subproperties to a property, first add the main property value (in this case, the whole PoS expression &#x201c;NOU-C(gender=n,number=sg)&#x201d;), followed by several other tokens at the same position (position increments of zero):</p>
<p>propPartOfSpeech.addValue(subPropertyName + ComplexFieldUtil.ASCII_UNIT_SEPARATOR + subPropertyValue, 0);</p>
<p>In our example, you might add three subproperty values: main=NOU-C (the &#x201c;main&#x201d; part of speech), gender=n and number=sg.</p>
<p>Then, to query these subproperties, use the following CQL extension syntax:</p>
<p>[pos:main=&#x201c;NOU-C&#x201d; &amp; pos:gender=&#x201c;n&#x201d; &amp; pos:number=&#x201c;sg&#x201d;]</p>
<p>These will effectively be translated into this:</p>
<p>[pos=&#x201c;main#NOU-C&#x201d; &amp; pos=&#x201c;gender#n&#x201d; &amp; pos=&#x201c;number#sg&#x201d;]</p>
<p>Except we don&#x2019;t use the hash sign as a separator, and we do some internal tricks to ensure wildcard and regex queries work properly.</p>
<p>Note that these subproperties will not have their own forward index; only the main property has one, and it includes only the first value indexed at any location, so the subproperty values aren&#x2019;t stored there either.</p>
<p>Adding a few subproperties per token position like this will make the index slightly larger, but it shouldn&#x2019;t affect performance or index size too much.</p>
<p><a name="payloads" id="payloads"></a></p></div>
<div class="section">
<h3><a name="Storing_extra_information_with_property_values_using_payloads"></a>Storing extra information with property values, using payloads</h3>
<p>It is possible to add payloads to property values. When calling addProperty() at the start of the constructor, make sure to use the version that takes a boolean called &#x2018;includePayloads&#x2019;, and set it to true. Then use ComplexFieldProperty.addPayload(). You can use null if a particular value has no payload. There&#x2019;s also a addPayloadAtIndex() method to add payloads some time after adding the value itself, but that requires knowing the index in the value list of the value you want to add a payload for, so you should store this index when you add the value.</p>
<p>One example of using payloads can be seen in DocIndexerXmlHandlers.InlineTagHandler. When you use InlineTagHandler to index an inline element, say a sentence tag, BlackLab will add a value (or several values, if the element has attributes) to the built-in &#x2018;starttag&#x2019; property. When it encounters the end tag, it wil update the start tag value with a payload indication the element length. This is used when searching to determine what matches occur inside certain XML tags.</p>
<p><a name="nonxml" id="nonxml"></a></p></div>
<div class="section">
<h3><a name="Indexing_non-XML_file_types"></a>Indexing non-XML file types</h3>
<p>If your input files are not XML or are not tokenized and annotated per word, you have two options: convert them into a tokenized, per-word annotated format, or index them directly.</p>
<p>Indexing them directly is not covered here, but involves deriving from DocIndexerAbstract or implementing the DocIndexer interface yourself. If you need help with this, please <a class="externalLink" href="mailto:jan.niestadt@ivdnt.org">contact us</a>.</p>
<p><a name="metadata" id="metadata"></a></p></div></div>
<div class="section">
<h2><a name="Metadata"></a>Metadata</h2>
<p><a name="metadata-in-document" id="metadata-in-document"></a></p>
<div class="section">
<h3><a name="In-document_metadata"></a>In-document metadata</h3>
<p>Some documents contain metadata within the document. You usually want to index these as fields with your document, so you can filter on them later. You do this by adding a handler for the appropriate XML element.</p>
<p>There&#x2019;s a few helper classes for in-document metadata handling. MetadataElementHandler assumes the matched element name is the name of your metadata field and the character content is the value. MetadataAttributesHandler stores all the attributes from the matched element as metadata fields. MetadataNameValueAttributeHandler assumes the matched element has a name attribute and a value attribute (the attribute names can be specified in the constructor) and stores those as metadata fields. You can of course easily add your own handler classes to this if they don&#x2019;t suit your particular style of metadata (have a look at nl.inl.blacklab.index.DocIndexerXmlHandlers.java to see how the predefined ones are implemented).</p>
<p><a name="metadata-external" id="metadata-external"></a></p></div>
<div class="section">
<h3><a name="Metadata_from_an_external_source"></a>Metadata from an external source</h3>
<p>Sometimes, documents link to external metadata sources, usually using an ID.</p>
<p>The MetadataFetcher is instantiated by DocIndexerXmlHandlers.getMetadataFetcher(), based on the metadataFetcherClass indexer parameter (see &#x201c;Passing indexing parameters&#x201d; above). This class is instantiated with the DocIndexer as a parameter, and the addMetadata() method is called just before adding a document to the index. Your particular MetadataFetcher can inspect the document to find the appropriate ID, fetch the metadata (e.g. from a file, database or webservice) and add it to the document using the DocIndexerXmlHandlers.addMetadataField() method.</p>
<p>Also see the two MetadataFetcher examples in nl.inl.blacklab.indexers.</p></div>
<div class="section">
<h3><a name="Add_a_fixed_metadata_field_to_each_document"></a>Add a fixed metadata field to each document</h3>
<p>It is possible to tell IndexTool to add a metadata field with a specific value to each document indexed. An example of when this is useful is if you wish to combine several corpora into a single index, and wish to distinguish documents from the different corpora using this metadata field. You would achieve this by running IndexTool twice: once to create the index and add the documents from the first corpus, &#x201c;tagging&#x201d; them with a field named e.g. Corpus_title (which is the fieldname <a class="externalLink" href="https://github.com/Taalmonsters/WhiteLab2.0">Whitelab</a> expects) with an appropriate value indicating the first corpus. Then you would run IndexTool again, with command &#x201c;append&#x201d; to append documents to the existing index, and giving Corpus_title a different value for this set of documents.</p>
<p>There&#x2019;s two ways to add this fixed metadata field for an IndexTool run. One is to pass an option &quot;&#x2014;meta-Corpus_title mycorpusname&quot; (note the 3 dashes!) to the IndexTool. The other is to place a property &quot;meta-Corpus_title=mycorpusname&quot; in a file called indexer.properties in the current directory. This file can be used for other per-run IndexTool configuration; see below.</p></div>
<div class="section">
<h3><a name="Controlling_how_metadata_is_fetched_and_indexed"></a>Controlling how metadata is fetched and indexed</h3>
<p>By default, metadata fields are tokenized, but it can sometimes be useful to index a metadata field without tokenizing it. One example of this is a field containing the document id: if your document ids contain characters that normally would indicate a token boundary, like a period (.) , your document id would be split into several tokens, which is usually not what you want. Use the indextemplate.json file (described above) to indicate you don&#x2019;t want a metadata field to be tokenized.</p></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                    2017
                        <a href="http://www.inl.nl">Instituut voor Nederlandse Taal (INT)</a>.
            All rights reserved.      
                    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
